<!-- Updated Appointments Page with Client Name, Notes Field, and AM/PM Format -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Appointments</title>
<style>
body { color:white;background:#141B34;font-family:sans-serif;margin:0; }
header {display:flex;justify-content:space-between;align-items:center;background:#141B34;border-bottom:1px solid white;padding:10px 20px;}
header h1{margin:0;}
nav ul{list-style:none;display:flex;margin:0;padding:0;}
nav li{margin-left:20px;}
nav a{color:white;text-decoration:none;}
nav a:hover{text-decoration:underline;}

.appointments{padding:20px;text-align:center;}
.schedule-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:20px;margin-top:20px;transition:transform .36s ease,opacity .36s ease;}
.day{background:#1F2A52;border-radius:8px;padding:15px;position:relative;}
.day h3{border-bottom:1px solid #444;padding-bottom:8px;margin-bottom:10px;}
.appointment-container{position:relative;min-height:200px;}
.appointment{position:absolute;background:#2D3A6A;border-radius:8px;padding:10px;text-align:left;cursor:pointer;transition:.2s;overflow:hidden;box-sizing:border-box;}
.appointment:hover{background:#3E4A8A;transform:scale(1.03);} 
.appointment span{font-weight:bold;display:block;}
.appointment p{margin:2px 0 0;font-size:.9em;color:#d0d8ff;}
.appointment.overlapping{border:2px solid #ff7676;box-shadow:0 0 8px rgba(255,100,100,.8);} 

.add-btn,#prevWeek,#nextWeek{background:#3E4A8A;color:white;border:none;border-radius:6px;padding:8px 12px;margin-top:10px;cursor:pointer;font-weight:bold;width:100%;transition:.3s;}
.add-btn:hover,#prevWeek:hover,#nextWeek:hover{background:#4E5ABB;transform:scale(1.03);} 

.week-nav{display:flex;justify-content:center;align-items:center;margin-top:20px;gap:20px;} 
.week-nav button{width:auto;padding:10px 20px;} 

.modal{display:none;position:fixed;z-index:10;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.6);} 
.modal-content{background:#1F2A52;margin:10% auto;padding:20px;border-radius:10px;width:300px;color:white;box-shadow:0 0 10px rgba(0,0,0,.5);} 
.modal-content h3{text-align:center;border-bottom:1px solid #555;padding-bottom:8px;} 
.modal-content label{display:block;margin-top:10px;text-align:left;} 
.modal-content input,.modal-content textarea{width:100%;padding:8px;margin-top:5px;border:none;border-radius:5px;} 
.submit-btn{width:100%;margin-top:15px;padding:10px;border:none;border-radius:6px;background:#3E4A8A;cursor:pointer;font-weight:bold;} 
.submit-btn:hover{background:#4E5ABB;} 

.close{color:#aaa;float:right;font-size:24px;font-weight:bold;cursor:pointer;} 
.close:hover{color:white;} 

footer{text-align:center;padding:10px;background:#141B34;border-top:1px solid white;margin-top:20px;} 

.slide-out-next{transform:translateX(-60px);opacity:0;} 
.slide-out-prev{transform:translateX(60px);opacity:0;} 
.slide-in-next{transform:translateX(60px);opacity:0;} 
.slide-in-prev{transform:translateX(-60px);opacity:0;} 
</style>
</head>
<body>

<header>
<h1>Appointments</h1>
<nav>
<ul>
<li><a href="index.html">Log Out</a></li>
<li><a href="realtorportal.html">Home</a></li>
<li><a href="realtormessages.html">Messages</a></li>
</ul>
</nav>
</header>

<main>
<section class="appointments">
<h2 id="weekLabel"></h2>
<div class="week-nav">
<button id="prevWeek">Previous Week</button>
<button id="nextWeek">Next Week</button>
</div>
<div class="schedule-grid">
<div class="day"><h3>Monday</h3><div class="appointment-container"></div><button class="add-btn">+ Add Appointment</button></div>
<div class="day"><h3>Tuesday</h3><div class="appointment-container"></div><button class="add-btn">+ Add Appointment</button></div>
<div class="day"><h3>Wednesday</h3><div class="appointment-container"></div><button class="add-btn">+ Add Appointment</button></div>
<div class="day"><h3>Thursday</h3><div class="appointment-container"></div><button class="add-btn">+ Add Appointment</button></div>
<div class="day"><h3>Friday</h3><div class="appointment-container"></div><button class="add-btn">+ Add Appointment</button></div>
</div>
</section>
</main>

<!-- Add Appointment Modal -->
<div id="appointmentModal" class="modal">
<div class="modal-content">
<span class="close" id="addClose">&times;</span>
<h3>Add New Appointment</h3>
<form id="appointmentForm">
<label for="startTimeInput">Start Time:</label>
<input type="time" id="startTimeInput" required>

<label for="endTimeInput">End Time:</label>
<input type="time" id="endTimeInput" required>

<label for="addressInput">Address:</label>
<input type="text" id="addressInput" required>

<label for="clientInput">Client Name:</label>
<input type="text" id="clientInput" required>

<label for="notesInput">Notes:</label>
<textarea id="notesInput" rows="3"></textarea>

<button type="submit" class="submit-btn">Add Appointment</button>
</form>
</div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
<div class="modal-content">
<span class="close" id="editClose">&times;</span>
<h3>Edit Appointment</h3>
<form id="editForm">
<label>Start Time:</label>
<input type="time" id="editStartTime" required>

<label>End Time:</label>
<input type="time" id="editEndTime" required>

<label>Address:</label>
<input type="text" id="editAddress" required>

<label>Client Name:</label>
<input type="text" id="editClient" required>

<label>Notes:</label>
<textarea id="editNotes" rows="3"></textarea>

<button type="submit" class="submit-btn">Save</button>
<button type="button" id="deleteBtn" class="submit-btn" style="background:#bb3e3e;margin-top:5px;">Delete</button>
</form>
</div>
</div>

<footer><small>Â© 2025 VillaVista Co.</small></footer>

<script>
function toAMPM(timeStr){
 if(!timeStr) return "";
 const [h,m] = timeStr.split(":").map(Number);
 const suffix = h>=12?"PM":"AM";
 const hour = h%12===0?12:h%12;
 return `${hour}:${m.toString().padStart(2,"0")} ${suffix}`;
}

let currentWeekStart = getStartOfWeek(new Date());
function getStartOfWeek(date){const d=new Date(date);const day=d.getDay();const diff=d.getDate()-day+(day===0?-6:1);return new Date(d.setDate(diff));}
const weekLabel=document.getElementById("weekLabel");
function updateWeekLabel(){const o={month:"numeric",day:"numeric",year:"2-digit"};const s=currentWeekStart;const e=new Date(s);e.setDate(s.getDate()+6);weekLabel.innerText=`Week of ${s.toLocaleDateString("en-US",o)} - ${e.toLocaleDateString("en-US",o)}`;}

let appointmentsData={};
function renderAppointmentsForWeek(){const days=document.querySelectorAll(".day");const names=["Monday","Tuesday","Wednesday","Thursday","Friday"];days.forEach((dayCol,i)=>{
 const container=dayCol.querySelector(".appointment-container");
 container.innerHTML="";
 const d=new Date(currentWeekStart);d.setDate(currentWeekStart.getDate()+i);
 const ds=d.toISOString().split("T")[0];
 const o={month:"numeric",day:"numeric",year:"2-digit"};
 dayCol.querySelector("h3").innerText=`${names[i]} ${d.toLocaleDateString("en-US",o)}`;

 if(appointmentsData[ds]){
   const appts=appointmentsData[ds];
   appts.sort((a,b)=>a.startTime.localeCompare(b.startTime));

   function overlaps(a,b){
    const sA=parseInt(a.startTime.slice(0,2))*60+parseInt(a.startTime.slice(3));
    const eA=parseInt(a.endTime.slice(0,2))*60+parseInt(a.endTime.slice(3));
    const sB=parseInt(b.startTime.slice(0,2))*60+parseInt(b.startTime.slice(3));
    const eB=parseInt(b.endTime.slice(0,2))*60+parseInt(b.endTime.slice(3));
    return sA<eB && eA>sB;
   }

   const columns=[];
   appts.forEach(appt=>{
     let colIndex=-1;
     for(let c=0;c<columns.length;c++){
       const last=columns[c][columns[c].length-1];
       if(!overlaps(appt,last)){colIndex=c;break;}
     }
     if(colIndex===-1){columns.push([appt]);colIndex=columns.length-1;} else columns[colIndex].push(appt);
     appt._colIndex=colIndex;
   });

   const totalCols=columns.length;
   appts.forEach((appt,index)=>{
    const div=document.createElement("div");div.classList.add("appointment");
    div.innerHTML=`<span>${toAMPM(appt.startTime)} - ${toAMPM(appt.endTime)}</span>
                   <p>${appt.address}</p>
                   <p style='font-size:0.8em;color:#aab3ff;'>Client: ${appt.client}</p>
                   <p style='font-size:0.75em;color:#9aa7ff;'>${appt.notes||""}</p>`;
    div.addEventListener("click",()=>openEditModal(ds,index));

    const [sH,sM]=appt.startTime.split(":"),[eH,eM]=appt.endTime.split(":");
    const sMin=+sH*60+ +sM, eMin=+eH*60+ +eM;
    div.style.top=(sMin/(24*60))*200+"px";
    div.style.height=Math.max(25,((eMin-sMin)/(24*60))*200)+"px";

    const col=appt._colIndex;const gap=6;const w=100/totalCols;
    div.style.width=`calc(${w}% - ${gap}px)`;
    div.style.left=`calc(${col*w}% + ${col*gap}px)`;
    if(totalCols>1)div.classList.add("overlapping");
    container.appendChild(div);
   });
 }
});}

const prevBtn=document.getElementById("prevWeek"),nextBtn=document.getElementById("nextWeek"),grid=document.querySelector(".schedule-grid");
let isAnimating=false;
function animateWeekChange(d){if(isAnimating)return;isAnimating=true;prevBtn.disabled=nextBtn.disabled=true;const out=d=="next"?"slide-out-next":"slide-out-prev";const inn=d=="next"?"slide-in-next":"slide-in-prev";grid.classList.remove("slide-in-next","slide-in-prev","slide-out-next","slide-out-prev");void grid.offsetWidth;grid.classList.add(out);
 function outDone(e){if(!["transform","opacity"].includes(e.propertyName))return;grid.removeEventListener("transitionend",outDone);currentWeekStart.setDate(currentWeekStart.getDate()+(d=="next"?7:-7));updateWeekLabel();renderAppointmentsForWeek();grid.classList.remove(out);grid.classList.add(inn);void grid.offsetWidth;requestAnimationFrame(()=>{
 grid.classList.remove(inn);
 function inDone(ev){if(!["transform","opacity"].includes(ev.propertyName))return;grid.removeEventListener("transitionend",inDone);isAnimating=false;prevBtn.disabled=nextBtn.disabled=false;}
 grid.addEventListener("transitionend",inDone);
});}
 grid.addEventListener("transitionend",outDone);
}
prevBtn.onclick=()=>animateWeekChange("prev");
nextBtn.onclick=()=>animateWeekChange("next");

const addModal=document.getElementById("appointmentModal"),addButtons=document.querySelectorAll(".add-btn"),addClose=document.getElementById("addClose"),addForm=document.getElementById("appointmentForm");
addButtons.forEach(btn=>btn.onclick=()=>{addModal.style.display="block";const days=[...document.querySelectorAll(".day")];addModal.dataset.dayIndex=days.indexOf(btn.parentElement);});
addClose.onclick=()=>addModal.style.display="none";
window.onclick=e=>{if(e.target===addModal)addModal.style.display="none";};
addForm.onsubmit=e=>{
 e.preventDefault();
 const dayIndex=parseInt(addModal.dataset.dayIndex);
 const d=new Date(currentWeekStart);d.setDate(currentWeekStart.getDate()+dayIndex);
 const ds=d.toISOString().split("T")[0];
 if(!appointmentsData[ds])appointmentsData[ds]=[];
 appointmentsData[ds].push({
  startTime:startTimeInput.value,
  endTime:endTimeInput.value,
  address:addressInput.value,
  client:clientInput.value,
  notes:notesInput.value
 });
 addModal.style.display="none";
 addForm.reset();
 renderAppointmentsForWeek();
};

const editModal=document.getElementById("editModal"),editClose=document.getElementById("editClose"),editForm=document.getElementById("editForm");
let editDayStr=null,editIndex=null;
function openEditModal(ds,i){editDayStr=ds;editIndex=i;const a=appointmentsData[ds][i];editStartTime.value=a.startTime;editEndTime.value=a.endTime;editAddress.value=a.address;editClient.value=a.client;editNotes.value=a.notes||"";editModal.style.display="block";}
editClose.onclick=()=>editModal.style.display="none";
window.onclick=e=>{if(e.target===editModal)editModal.style.display="none";};
editForm.onsubmit=e=>{
 e.preventDefault();
 appointmentsData[editDayStr][editIndex]={startTime:editStartTime.value,endTime:editEndTime.value,address:editAddress.value,client:editClient.value,notes:editNotes.value};
 editModal.style.display="none";
 renderAppointmentsForWeek();};
deleteBtn.onclick=()=>{
 appointmentsData[editDayStr].splice(editIndex,1);
 if(!appointmentsData[editDayStr].length)delete appointmentsData[editDayStr];
 editModal.style.display="none";
 renderAppointmentsForWeek();};

updateWeekLabel();renderAppointmentsForWeek();
</script>
</body>
</html>
